## Objective Questions

![Screenshot (529)](https://github.com/user-attachments/assets/3d76d7e8-aee7-4034-8ef8-24bf5461c231)

The Objective of this Lab is to identify if there was a Malware infection, what the origin of the Malware is, what type of malware infection it is, alongside answering some general questions.

----------------------------------------------------------------------------------------

![Screenshot (443)](https://github.com/user-attachments/assets/7728c0f0-f40a-42ce-adf3-61441ef819e4)

I am using a Kali Linux Machine to perform my Pcap Analysis, The tools I will be using is wireshark, Zui as well as the website virustotal.

----------------------------------------------------------------------------------------

![Screenshot (444)](https://github.com/user-attachments/assets/fa85602b-fe7f-4189-9a29-1b88836d4024)

Firstly I head to view, select time display format, and select UTC date and time of day. This will help standardize our time of collection and make everything easier to work with because we arent worried about timezones or system times.

-----------------------------------------------------------------------------------------

![Screenshot (445)](https://github.com/user-attachments/assets/961d540a-dd13-4987-8046-59b840d615c2)

Next I Click on Edit and select Preferences. I want to add some additional columns to wireshark source port and destination port. 

-----------------------------------------------------------------------------------------

![Screenshot (446)](https://github.com/user-attachments/assets/04049bc9-f3bb-4ee9-ba66-12436e71d8da)

Once preferences opens, I select columns and press the little plus button to add a new column.

------------------------------------------------------------------------------------------

![Screenshot (448)](https://github.com/user-attachments/assets/8451a257-c62c-479a-b8f8-fba6b3440516)

When selecting a type for the ports I select (Unresolved) for both the src and dst port.

-------------------------------------------------------------------------------------------

![Screenshot (450)](https://github.com/user-attachments/assets/e02f8132-41a4-4e7d-b474-1ed683de7100)

Here's my new columns added.

---------------------------------------------------------------------------------------------

![Screenshot (452)](https://github.com/user-attachments/assets/4cb6ad2e-deaa-4623-af2f-739049436252)

I click on statistics and select Capture File Properties.

----------------------------------------------------------------------------------------------

![Screenshot (454)](https://github.com/user-attachments/assets/109511ab-5e96-4db4-902a-ab460e72ba65)

I want to highlight the time of the first and last packet. It is important to know you're working with the correct data sets and not spending time looking into a pcap file that is from an hour before the attack. Close that.

----------------------------------------------------------------------------------------------

![Screenshot (455)](https://github.com/user-attachments/assets/2d0c6509-a2c3-490a-a7ca-a852a8a38f00)

I Click on statistics again and this time I click on Protocol Hierarchy.

----------------------------------------------------------------------------------------------

![Screenshot (456)](https://github.com/user-attachments/assets/a3ca2e0c-8827-44c2-b588-681362b81dfe)

I can see IPV4, DNS, TLS, and HTTP are all being used in this PCAP. Close this.

----------------------------------------------------------------------------------------------

![Screenshot (457)](https://github.com/user-attachments/assets/714cbdfd-d4f3-41c6-8cb9-b202495c8a79)

I click on statistics again, and select Converstations.

---------------------------------------------------------------------------------------------

![Screenshot (459)](https://github.com/user-attachments/assets/c92dae9e-e224-4fcc-8cd3-8f222d82b0ae)

Looking at conversations tabs I see there is 9 IPV4 address that we're invloved in the PCAP. I will sort the IPV4 conversations by bytes size. 

--------------------------------------------------------------------------------------------------

![Screenshot (460)](https://github.com/user-attachments/assets/8228a5dd-68fc-4770-9ef8-7ef3eb8e5871)

There are three IP address that have a larger ammount of packets sent and recieved. SO I will add them to my notes. 

-----------------------------------------------------------------------------------------------

![Screenshot (461)](https://github.com/user-attachments/assets/55df8348-3b09-4add-bc7f-43184aabe99b)

I head back to my wireshark dashboard and the packets 3,4,5 show a 3 way handshake to a website named Klychenogg.com I added it to my notes as it is a site of interest. Another point of note is the IP address that is associated with the domain is one of our IP's of Interest 95.181.198.231

-----------------------------------------------------------------------------------------------

![Screenshot (462)](https://github.com/user-attachments/assets/ca3983c2-6402-441f-855d-ba2dfc44d224)



------------------------------------------------------------------------------------------------

![Screenshot (463)](https://github.com/user-attachments/assets/f50105fd-4f74-4f16-8cdb-912d5d2ce0be)

I head to virustotal.com to search for our suspicious domain. 
 

------------------------------------------------------------------------------------------------

![Screenshot (464)](https://github.com/user-attachments/assets/3db82289-8e92-4108-a2d3-ecf4cf238f0a)


It is flagged as a malicious site by beyond that there isn't any more valuable information.

-----------------------------------------------------------------------------------------------

![Screenshot (465)](https://github.com/user-attachments/assets/b34bdf08-631b-4d64-be2b-f167ca0b7e80)

I will search for the associated IP as well to see if there is any additional information. 

------------------------------------------------------------------------------------------------

![Screenshot (466)](https://github.com/user-attachments/assets/4922f6e1-7c17-4ceb-8ccc-7c796e198162)

Search 

-----------------------------------------------------------------------------------------------

![Screenshot (467)](https://github.com/user-attachments/assets/290929fb-104f-471f-8bd4-f366e5e53d85)

It is flagged as clean and there is no additonal valuable information.

----------------------------------------------------------------------------------------------

![Screenshot (468)](https://github.com/user-attachments/assets/d90b18f0-5074-4054-bba2-c9327cd4f226)

I head back to my wireshark dashboard. On packet number 6 there is a GET request. I right click the packet, select Follow, and Follow HTTP Stream.

---------------------------------------------------------------------------------------------

![Screenshot (470)](https://github.com/user-attachments/assets/c245e620-66cc-4df2-822f-46663f4941e6)

I see at the top of the page the GET request. It is retriving a file named spet10.spr from the URL /tewok1.php. The response includes headers indicating the file being sent is an attachment with the content type application/octet-stream suggesting it could be a binary file like a macro-laden document.  

---------------------------------------------------------------------------------------------

![Screenshot (471)](https://github.com/user-attachments/assets/8c792681-441c-416d-b556-fda52afadf46)

Another strong indicator is "..Cannot be run in DOS mode." this again indicates it likely an executable or a macro document.

---------------------------------------------------------------------------------------------


![Screenshot (473)](https://github.com/user-attachments/assets/2bb0531d-7c71-47aa-ba88-35a8484c865c)

I will add some notes, including time of the request and any points of interest.

---------------------------------------------------------------------------------------------

![Screenshot (474)](https://github.com/user-attachments/assets/fde5daf0-f5bd-462a-a40a-361ce285b0ea)

For some reason my packets are no longer in numerical order, but it makes no difference. I want to filter for HTTP packets. So i right click the packet and apply as filter.

----------------------------------------------------------------------------------------------

![Screenshot (475)](https://github.com/user-attachments/assets/a9739e21-1df0-4f3e-bf09-062a47ea482a)

HTTP protocol has been added as a filter.

---------------------------------------------------------------------------------------------

![Screenshot (476)](https://github.com/user-attachments/assets/dd4ec348-68bd-4730-8327-074960d9c5c5)

Added as a filter.

---------------------------------------------------------------------------------------------

![Screenshot (477)](https://github.com/user-attachments/assets/0fd4b75e-2be4-4711-839f-99b7215c1261)


I also want to add the IP address from packet 6 as a filter as well. 

---------------------------------------------------------------------------------------------

![Screenshot (478)](https://github.com/user-attachments/assets/0321ea63-d2d6-4939-aafe-7d8f19192565)

When I search with the filter there are 2 packets that appear our original GET request as well as a new packet 911 including its own GET request.

---------------------------------------------------------------------------------------------

![Screenshot (479)](https://github.com/user-attachments/assets/cb34cb29-139c-4da0-b118-8b79fc25ea4e)

I right click the packet 911 and Follow HTTP stream.

----------------------------------------------------------------------------------------------

![Screenshot (480)](https://github.com/user-attachments/assets/7087db90-1718-4e35-b7b9-6238257b71f0)

The GET request is retriving oiioiashdqbwe.rar file. I add a time, the packet number as well as quick descritpion of the GET request. Beyond that there isn't much additional information.

----------------------------------------------------------------------------------------------

![Screenshot (483)](https://github.com/user-attachments/assets/9222a1d0-19f4-4dce-b1a2-810f550fd101)

I move onto the second suspicious IP address we have added to our notes. I do this by filtering a search for the IP incoming and outgoing packets using "ip.addr==176.32.33.108" 

----------------------------------------------------------------------------------------------

![Screenshot (484)](https://github.com/user-attachments/assets/c37ddf35-0eb0-4db6-9818-1697f0e9ec5a)

Packet 288 is a point of interest as it is a HTTP GET request. 

----------------------------------------------------------------------------------------------

![Screenshot (485)](https://github.com/user-attachments/assets/71898101-3b4c-4c52-bebc-a1847bcb5b3e)

Right Click and Follow HTTP Stream.

----------------------------------------------------------------------------------------------

![Screenshot (486)](https://github.com/user-attachments/assets/da7c4b14-b949-4cc9-b986-51e9561bd641)

The GET request is retriving ojw.avi file. A point of interest is the host destination of the file cochrimato.com. I will add that to my notes, and head to virus total to do a search of the host domain as well as the IP.

----------------------------------------------------------------------------------------------

![Screenshot (487)](https://github.com/user-attachments/assets/ec13d583-35e2-4b98-9c72-7e6a65536e17)

Search for cochrimato.com

----------------------------------------------------------------------------------------------

![Screenshot (488)](https://github.com/user-attachments/assets/6f57b147-f665-4cd5-af12-9308b5cb31e3)

It is flagged as a mlaicious URL, but doesn't provide much additional information so let's move on to searching for the asociated IP.

----------------------------------------------------------------------------------------------

![Screenshot (489)](https://github.com/user-attachments/assets/c14b2caa-d6b2-4b5d-96f6-b19ad5fd45fc)

The associated IP is 176.32.33.108, which is based on the destination of packet 288.

----------------------------------------------------------------------------------------------

![Screenshot (490)](https://github.com/user-attachments/assets/acb9ae9c-50ac-491d-9217-f4ff108917b8)

Search.

----------------------------------------------------------------------------------------------

![Screenshot (491)](https://github.com/user-attachments/assets/25f8bf03-d5d6-47f6-92a7-b8cbcee637de)

It comes back as clean so let's move onto out final IP of interest.

----------------------------------------------------------------------------------------------

![Screenshot (492)](https://github.com/user-attachments/assets/7a1e1640-580b-424c-b4b6-e7d33c4408d3)

The IP is 83.166.247.211

----------------------------------------------------------------------------------------------

![Screenshot (493)](https://github.com/user-attachments/assets/682b061d-eca3-4858-9904-30232053b0cf)

I again will use the ip.addr filter and search.

----------------------------------------------------------------------------------------------

![Screenshot (494)](https://github.com/user-attachments/assets/62cda983-30cf-44d1-aa0e-edf06f81b55e)

Looking at packet 757 something of note is the SNI which is the URL mautergase.com, another point of note is the encrpytion method TLSv1.2

-----------------------------------------------------------------------------------------------

![Screenshot (499)](https://github.com/user-attachments/assets/052f2c6d-45c3-47c0-b32d-f82b821a6b83)

I will now do a virustotal search on the newly found URL mautergase.com.

----------------------------------------------------------------------------------------------

![Screenshot (500)](https://github.com/user-attachments/assets/a5425bf9-3a54-4a50-830f-042e85558180)

It comes back as malicious so I make note and move on, as there isn't any addiitonal information.

----------------------------------------------------------------------------------------------

![Screenshot (502)](https://github.com/user-attachments/assets/f24171a9-cee1-49f4-9381-450cb334b4c0)

I will search for DNS as well as it is part of our protocol hierarchy.

---------------------------------------------------------------------------------------------

![Screenshot (503)](https://github.com/user-attachments/assets/aa95d344-b9e5-4f9d-ab08-41eed01a5736)

Packet 753 shows a query response from the URL mautergase.com.

---------------------------------------------------------------------------------------------

![Screenshot (504)](https://github.com/user-attachments/assets/db58f35b-d150-49c7-8453-da3bd40f8d6e)

Based on findings the most noteable piece of evidence found is the get request of the .rar file on pack 911, so lets head back to that and see what packet exchange happened. Following the GET request.

---------------------------------------------------------------------------------------------

![Screenshot (506)](https://github.com/user-attachments/assets/b9fd5569-f626-41d6-9db8-fbf48224db06)

Scrolling down I notice a new IP, 185.244.150.230 closely following our initial GET request for the .rar file.

---------------------------------------------------------------------------------------------

![Screenshot (507)](https://github.com/user-attachments/assets/56c34767-ec82-4f49-b97b-4076549820ac)

I will do a Virustotal search of our newly found IP

---------------------------------------------------------------------------------------------

![Screenshot (508)](https://github.com/user-attachments/assets/07ebae14-d637-401f-acb0-5b5f9ec974c4)

This IP does come back as malicious, but again there isnt much more information we can pull from this.

---------------------------------------------------------------------------------------------

![Screenshot (509)](https://github.com/user-attachments/assets/135ec441-e897-41fa-8d79-50dca447ca8e)

 I will now use ZUI to see what more information we can pull from the PCAP file. 

--------------------------------------------------------------------------------------------

![Screenshot (510)](https://github.com/user-attachments/assets/7688f04f-60a6-4c18-a1e7-24d0e05afd1d)

I drag and drop the PCAP file into ZUI and begin my search.

--------------------------------------------------------------------------------------------

![Screenshot (511)](https://github.com/user-attachments/assets/44196ede-8930-40dc-bbe4-78fa6bd5370e)

I will search for alert as ZUI automatically compiles Packets of interest or Alert Packets for us to take a look at.

--------------------------------------------------------------------------------------------

![Screenshot (512)](https://github.com/user-attachments/assets/72f70ea9-5866-478d-b054-a1fad0762af9)

Search for Alert

--------------------------------------------------------------------------------------------

![Screenshot (513)](https://github.com/user-attachments/assets/ba2c40b0-5388-437e-8d27-7eb3d25fc74b)

I then right click alert(1) and select filter == value, to filter out only alerts.

--------------------------------------------------------------------------------------------

![Screenshot (514)](https://github.com/user-attachments/assets/a216e9e8-65e9-4701-9207-6f5711daf7eb)

We can see the alerts, and if we notice the top three alerts include the malicious IP of 185.244.150.230. Alerts sort from most recent to least recent. So I select the first Alert Packet and expand it.

--------------------------------------------------------------------------------------------

![Screenshot (516)](https://github.com/user-attachments/assets/2887d8cd-b90f-494d-ae35-a001e85926e8)

Once expanded we can see that signature which laerts us there is malware, and it matches the dridex malware.

--------------------------------------------------------------------------------------------

![Screenshot (518)](https://github.com/user-attachments/assets/67045562-8093-402c-9ede-f8bb0706198d)

I now head to Wireshark so I am able to export all HTTP objects. I do this by selecting file, export objects, and HTTP. 

--------------------------------------------------------------------------------------------

![Screenshot (519)](https://github.com/user-attachments/assets/1845d880-cf32-4eec-bb00-e24e735ec998)

I will now click save all so I am able to hash the files and see if their hash matches any known malware. 

-------------------------------------------------------------------------------------------

![Screenshot (521)](https://github.com/user-attachments/assets/a4781a60-d44d-484e-9267-466f31d823e1)

Once it is saved I open a terminal in the file.

-------------------------------------------------------------------------------------------

![Screenshot (522)](https://github.com/user-attachments/assets/a42afea9-1bdf-4075-9e11-9c2f45d184c3)

Terminal Open.

-------------------------------------------------------------------------------------------

![Screenshot (523)](https://github.com/user-attachments/assets/f2849132-3f9e-4828-949d-5a1c7dcc7f2e)

I will use the file * command to give me a brief description of all files.

-------------------------------------------------------------------------------------------

![Screenshot (524)](https://github.com/user-attachments/assets/8432a394-939f-4b5f-a5c4-ebf26535131e)

The downloaded .spr file is a PE32 executable that is interesting, along side a ms windows icon. This is a strong indicator of malware.

-------------------------------------------------------------------------------------------

![Screenshot (525)](https://github.com/user-attachments/assets/127b48cf-b28c-49e8-bb4c-11131fcbd25c)

I use the sha256sum command to hash all the eported items and search for them on virustotal.

--------------------------------------------------------------------------------------------

![Screenshot (526)](https://github.com/user-attachments/assets/5e23f5b2-f62b-46e9-a1be-1d51d6ccfd64)

You can search for each individual file hash, but I already know the file of interest is the .spr file so I will copy that hash and search.

--------------------------------------------------------------------------------------------

![Screenshot (527)](https://github.com/user-attachments/assets/f540bf90-d969-403a-b2ed-6d0dcf3ee85c)

Search for the Hash.

--------------------------------------------------------------------------------------------

![Screenshot (528)](https://github.com/user-attachments/assets/7bf2be3b-7237-4038-9416-2828046add4e)

It is a malicious software. If we look at the threat catagory we can see it is a trojan and a spyware, we have succesfully identified the malware. 

--------------------------------------------------------------------------------------------

![Screenshot (531)](https://github.com/user-attachments/assets/e36b0de6-cc40-4cfa-a2fa-eedc315d46f1)

Now lets answer the questions first one being what is the private IP of the infected host. If we look at our wireshark dashboard  We can see our infected IP is 10.11.27.101.

--------------------------------------------------------------------------------------------

![Screenshot (532)](https://github.com/user-attachments/assets/9522a53f-ee76-445a-a5bb-7bc420e1a780)

The next question is What's the malware binary that the macro document is trying to retrive.
We will head to packet 6 where the .spr file is being retrived and follow HTTP stream.

--------------------------------------------------------------------------------------------

![Screenshot (533)](https://github.com/user-attachments/assets/bd2fb190-f3d5-47e1-a4ed-b5e473f7b9de)

The answer as discussed previously is spet10.spr

---------------------------------------------------------------------------------------------

![Screenshot (534)](https://github.com/user-attachments/assets/c58386e0-8153-4bab-87d5-132e88c4f996)

I will update my answers and move on. Next question, What domain do HTTP requests with GET/images/ coming from? 

--------------------------------------------------------------------------------------------

![Screenshot (535)](https://github.com/user-attachments/assets/edab41d9-7454-443c-a17c-a8f8a1f9257e)

If we head to packet 288 where we had a GET image request and follow the HTTP stream. 

--------------------------------------------------------------------------------------------

![Screenshot (536)](https://github.com/user-attachments/assets/593ed0ab-c99a-4207-8ad2-d1b88595c0f7)

We can see the host is cochrimato.com. That is the answer.

--------------------------------------------------------------------------------------------

![Screenshot (537)](https://github.com/user-attachments/assets/3c7af9f4-96d7-4338-96c2-19b170c49735)

Finally what is the malware post infection IP address ? If we go back to our ZUI alerts we can see the IP 185.244.150.230. That is our answer 

--------------------------------------------------------------------------------------------

![Screenshot (538)](https://github.com/user-attachments/assets/22d4b27b-8736-4c88-a309-67f1828529e7)

That is a succesful analysis of the dridex malware using wireshark and ZUI. This shows an advanced understanding of wireshark, as well as general understanding of packet transfer and malware analysis. 
